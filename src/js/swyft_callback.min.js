(function($,window,document,undefined){"use strict";var pluginName="swyftCallback",form_obj_prefix='sc_',form_fields_prefix='sc_fld_',input_all_mask='input, select, textarea',defaults={api:{url:'test',custom:[{name:'api_key',value:''},],param:{success:{name:'result',value:'success'},message:'',},callback:{success:{function:null,this:this,parameters:null,},error:{function:null,this:this,parameters:null,}}},data:{form_method:"post",custom_button_data:"",custom_popup_data:"",},appearance:{custom_button_class:"",custom_popup_class:"",},status:{popup_hidden:!0,button_disabled:!1,ajax_processing:!1,response_from_api_visible:!0,},text_vars:{popup_title:"Contact form",popup_body:"Leave us your phone number. We'll call you back.",send_button_text:"Send",wrong_input_text:"Wrong input",status_success:"Form sent successfuly",status_sending:"Sending form...",status_error:"Server encountered and error",},novalidate:!0,input:{prefix:form_fields_prefix,fields:[{obj:null,name:'phone',field_name:form_fields_prefix+'telephone',label:'Phone number',type:'tel',data_field_type:'phone',placeholder:'000-000-000',max_length:20,required:!0},],agreements:[{obj:null,field_name:form_fields_prefix+'agreement',type:'checkbox',short:'Lorem',long:'Ipsum',readmore:'More',required:!0}],regex_table:{'phone':/(\(?(\+|00)?48\)?([ -]?))?(\d{3}[ -]?\d{3}[ -]?\d{3})|([ -]?\d{2}[ -]?\d{3}[ -]?\d{2}[ -]?\d{2})/,'email':/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,'name':/^[a-zA-ZàáâäãåąčćęèéêëėįìíîïłńòóôöõøùúûüųūÿýżźñçčšśžÀÁÂÄÃÅĄĆČĖĘÈÉÊËÌÍÎÏĮŁŃÒÓÔÖÕØÙÚÛÜŲŪŸÝŻŹÑßÇŒÆČŠŚŽ∂ð ,.'-]+$/},data_dictionary:{}},};function Plugin(element,options){this.element=element;this.settings=$.extend(!0,{},defaults,options);this._defaults=defaults;this._name=pluginName;this.setDefaultVars();this.button={obj:null};this.popup={obj:null,form:null,footer:null};this.init()}
    $.extend(Plugin.prototype,{init:function(){this.initPopup();this.initButton()},setDefaultVars:function(){if(this.settings.input.fields){var template=defaults.input.fields[0];for(var i=0;i<this.settings.input.fields.length;i++){this.settings.input.fields[i]=$.extend({},template,this.settings.input.fields[i])}}
            if(this.settings.input.agreements){var template=defaults.input.agreements[0];for(var i=0;i<this.settings.input.agreements.length;i++){this.settings.input.agreements[i]=$.extend({},template,this.settings.input.agreements[i])}}},formatClasses:function(input){var _input=input;var input_length=_input.length;var output='';if(input){output+=' ';if(input.constructor===Array){for(var i=0;i<input_length;i++){output+=_input[i]+' '}
            if(output[output.length-1]==' '){output=output.slice(0,-1)}}else{output+=_input}}
            return output},initButton:function(){var objThis=this;var classes=this.formatClasses(this.settings.appearance.custom_button_class);var data=this.formatData(this.settings.data.custom_button_data);var $buttonBody=$('<div class="'+form_obj_prefix+'tg_btn'+classes+'" '+data+'>\n'+'    <div class="'+form_obj_prefix+'round_container">\n'+'        <div class="'+form_obj_prefix+'icon">'+'           <a href="#"></a>\n'+'        </div>\n'+'    </div>\n'+'</div>');this.button.obj=$buttonBody.appendTo($(this.element));this.button.obj.find('a').on('click',function(e){e.preventDefault();objThis.TogglePopup()})},initPopup_generate_fields:function(popupBody){var fields='';var dynamic_attributes=[];if(this.settings.input.fields){var fields_section=popupBody.find('.'+form_obj_prefix+'fields_section');for(var i=0;i<this.settings.input.fields.length;i++){var field=this.settings.input.fields[i];dynamic_attributes=[{name:'input',attributes:[{key:'id',value:field.field_name},{key:'name',value:field.field_name},{key:'type',value:field.type},{key:'data-field-type',value:field.data_field_type},{key:'placeholder',value:field.placeholder},{key:'value',value:field.value},{key:'maxlength',value:field.max_length},{key:'required',value:field.required},],formatted:''},];dynamic_attributes=this.formatDynamicAttributes(dynamic_attributes);var output='<div class="'+form_obj_prefix+'division">\n'+'               <div class="input">\n'+'                   <label for="'+field.field_name+'">'+field.label+'</label>\n'+'                   <input '+dynamic_attributes[0].formatted+'/>\n'+'               </div>\n'+'             </div>\n';fields+=output;var $obj=$(output).appendTo(fields_section);this.settings.input.fields[i].obj=$obj.find(input_all_mask).first()}}
            return fields},initPopup_generate_popup_agreements:function(popupBody){var agreements='';var agreements_section=popupBody.find('.'+form_obj_prefix+'agreements_section');if(this.settings.input.agreements){for(var i=0;i<this.settings.input.agreements.length;i++){var agreement=this.settings.input.agreements[i];var output='<div class="'+form_obj_prefix+'division">'+'           <div class="input">'+'               <div class="'+form_obj_prefix+'checkbox_container">\n'+'                   <input id="'+agreement.field_name+'" name = "'+agreement.field_name+'" type="checkbox" checked="checked" value="true" data-field-type="checkbox" />\n'+'                   <span class="checkmark"></span>\n'+'               </div>\n'+'\n'+'               <label for="'+agreement.field_name+'">'+agreement.short+' <span class="'+form_obj_prefix+'readmore">'+agreement.readmore+' </span></label>\n'+'               <span class="'+form_obj_prefix+'readmore_body" style="display: none;">\n'+'                   '+agreement.long+'               </span>\n'+'           </div>'+'         </div>';agreements+=output;var $obj=$(output).appendTo(agreements_section);this.settings.input.agreements[i].obj=$obj.find(input_all_mask).first()}}
            return agreements},initPopup_generate_popup_body:function(){var dynamic_attributes=[];var classes=this.formatClasses(this.settings.appearance.custom_popup_class);dynamic_attributes=[{name:'form',attributes:[{key:'action',value:this.settings.api.url},{key:'method',value:this.settings.data.form_method},{key:'novalidate',value:this.settings.novalidate},],formatted:''},];dynamic_attributes=this.formatDynamicAttributes(dynamic_attributes);var $popupBody='<div class="'+form_obj_prefix+'overlay" style="display: none;">\n'+'    <div class="'+form_obj_prefix+'popup_container">\n'+'        <div class="'+form_obj_prefix+'popup'+classes+'">\n'+'            <div class="'+form_obj_prefix+'btn_close"></div>\n'+'            <div class="'+form_obj_prefix+'title_section">\n'+'                <p>'+this.settings.text_vars.popup_title+'</p>\n'+'            </div>\n'+'\n'+'            <div class="'+form_obj_prefix+'body_section">\n'+'                <p>'+this.settings.text_vars.popup_body+'</p>\n'+'                <form '+dynamic_attributes[0].formatted+'>\n'+'                    <div class="container-fluid no-padding">\n'+'                        <div class="row">\n'+'                            <div class="col-xs-12 '+form_obj_prefix+'fields_section">\n'+'                            </div>\n'+'\n'+'                            <div class="col-xs-12">\n'+'                                <div class="'+form_obj_prefix+'division">\n'+'                                    <button type="submit" class="'+form_obj_prefix+'btn_submit">'+this.settings.text_vars.send_button_text+'</button>\n'+'                                </div>\n'+'                            </div>\n'+'                        </div>\n'+'\n'+'                        <div class="row '+form_obj_prefix+'agreements">\n'+'                            <div class="col-xs-12 '+form_obj_prefix+'agreements_section">\n'+'                            </div>\n'+'                        </div>\n'+'                    </div>\n'+'                </form>\n'+'            </div>\n'+'\n'+'            <div class="'+form_obj_prefix+'footer_section">\n'+'\n'+'            </div>\n'+'        </div>\n'+'    </div>'+'</div>';return $popupBody},initPopup:function(){var objThis=this;var $popupBody=$(this.initPopup_generate_popup_body());this.popup.obj=$popupBody.appendTo($(this.element));this.popup.form=this.popup.obj.find('form');this.popup.footer=this.popup.obj.find('.'+form_obj_prefix+'footer_section');this.initPopup_generate_fields($popupBody);this.initPopup_generate_popup_agreements($popupBody);this.popupAppendEventListeners();this.popupApplyMisc()},popupAppendEventListeners:function(){var objThis=this;this.popup.form.find('.checkmark').on('click',function(e){e.preventDefault();var input=$(this).siblings('input');input.prop('checked',!input.prop('checked')).change()});this.popup.form.find('.'+form_obj_prefix+'readmore').on('click',function(e){e.preventDefault();objThis.showReadmore(this)});this.popup.obj.find('.'+form_obj_prefix+'btn_close').on('click',function(e){e.preventDefault();objThis.ClosePopup()});for(var i=0;i<objThis.settings.input.fields.length;i++){var field=objThis.settings.input.fields[i];field.obj.data('index',i);field.obj.on('input',function(e){var index=$(this).data('index');var validated=objThis.ValidateForm([objThis.settings.input.fields[index]],{append_status:!1,focus_first_wrong:!1});if(validated){console.log('validation successful')}
            return!1})}
            for(var i=0;i<objThis.settings.input.agreements.length;i++){var agreement=objThis.settings.input.agreements[i];agreement.obj.data('index',i);agreement.obj.on('change',function(e){var index=$(this).data('index');var validated=objThis.ValidateForm([objThis.settings.input.agreements[index]],{append_status:!1,focus_first_wrong:!1});if(validated){console.log('validation successful')}
                return!1})}
            this.popup.obj.on('submit',function(e){var status=objThis.SendData({callback:{success:{function:objThis.SendDataReturn,this:objThis,parameters:[objThis.settings.text_vars.status_success,'success']},error:{function:objThis.SendDataReturn,this:objThis,parameters:[objThis.settings.text_vars.status_error,'error']}}});console.log('Submit form status: '+status.success+', '+status.message);return!1})},showReadmore:function(obj){var $this=$(obj);$this.closest('.'+form_obj_prefix+'division').find('.'+form_obj_prefix+'readmore_body').slideToggle()},hideReadmore_all:function(){this.popup.form.find('agreements input[type="checkbox"]').prop('checked',!1)},popupApplyMisc:function(){var inputs=$(input_all_mask);console.log('js input mask: '+(typeof $.fn.inputmask!=='undefined'));if(typeof $.fn.inputmask!=='undefined'){var input_masked_items=inputs.filter('input[type="tel"], .jsm_phone');var phones_mask=["###-###-###","## ###-##-##"];console.log('js input mask || masked items: ');console.log(input_masked_items);input_masked_items.inputmask({mask:phones_mask,greedy:!1,definitions:{'#':{validator:"[0-9]",cardinality:1}}})}},SendData:function(options){var status={success:!1,message:'SendData: Error (Default)'};var defaults={url:this.settings.api.url,api_custom:this.settings.api.custom,data:this.popup.form.serialize(),data_dictionary:this.settings.input.data_dictionary,type:this.settings.data.form_method,success_param:this.settings.api.param.success,return_param:this.settings.api.param.message,status_sending_text:this.settings.text_vars.status_sending,};var settings=$.extend(!0,{},defaults,options);this.StatusClear();var validated_fields=this.ValidateForm(this.settings.input.fields);var validated_agreements=this.ValidateForm(this.settings.input.agreements);var validated=validated_fields&&validated_agreements;if(validated){console.log('Validation successful');console.log('Attempting to send data...');this.StatusClear();this.StatusAdd(this.settings.status_sending_text,{});status=this.SendDataAjax(settings)}else{status={success:!1,message:'SendData: Error (Validation)'}}
            return status},SendDataAjax:function(options){var status={success:!1,message:'SendDataAjax: Error (Default)'};var objThis=this;var defaults={url:'/',type:'POST',api_custom:[],data:'',data_dictionary:{},success_param:{name:'result',value:'success'},return_param:'message',};var settings=$.extend(!0,{},defaults,options);if(settings.api_custom){var api_custom_length=settings.api_custom.length;var custom_data_string='';if(settings.data.length>0){custom_data_string+='&'}
            for(var i=0;i<api_custom_length;i++){custom_data_string+=settings.api_custom[i].name+'='+settings.api_custom[i].value;if(i<api_custom_length-1){custom_data_string+='&'}}
            settings.data+=encodeURI(custom_data_string)}
            var data_dictionary_keys=Object.keys(settings.data_dictionary);for(var i=0;i<data_dictionary_keys.length;i++){var regex=settings.data_dictionary[data_dictionary_keys[i]];console.log(data_dictionary_keys[i]+' > '+regex);settings.data=settings.data.replace(data_dictionary_keys[i],regex)}
            console.log(settings);if(this.settings.status.ajax_processing){status={success:!1,message:'SendDataAjax: Error (Processing...)'}}else{this.settings.status.ajax_processing=!0;status={success:!0,message:'SendDataAjax: Success (Got into ajax)'};$.ajaxSetup({headers:{'Content-Type':'application/x-www-form-urlencoded; charset=UTF-8','X-Requested-With':'XMLHttpRequest'}});$.ajax({url:settings.url,type:settings.type,data:settings.data,enctype:'multipart/form-data',dataType:'json',processData:!1,success:function(data){var response_success=!1;var return_message;console.log(data);if(data[settings.return_param]){for(var index in data[settings.return_param]){console.log(data[settings.return_param][index])}
                    console.log('API status: '+data.status);console.log('API message: ');console.log(data[settings.return_param])}
                    if($.isArray(data[settings.return_param])){return_message=data[settings.return_param].join(', ')}else{return_message=data[settings.return_param]}
                    console.log(return_message);if(data[settings.success_param.name]){if(data[settings.success_param.name]===settings.success_param.value){status={success:!0,message:'Success (API x:200)'};response_success=!0}else{response_success=!1}}else{response_success=!1}
                    if(response_success){if(settings.callback.success.function&&$.isFunction(settings.callback.success.function)){settings.callback.success.function.apply(settings.callback.success.this,settings.callback.success.parameters)}
                        if(objThis.settings.api.callback.success.function&&$.isFunction(objThis.settings.api.callback.success.function)){objThis.settings.api.callback.success.function.apply(objThis.settings.api.callback.success.this,[$.extend(!0,{},data,objThis.settings.api.callback.success.parameters)])}}else{if(settings.callback.error.function&&$.isFunction(settings.callback.error.function)){settings.callback.error.function.apply(settings.callback.error.this,settings.callback.error.parameters)}
                        if(objThis.settings.api.callback.error.function&&$.isFunction(objThis.settings.api.callback.error.function)){objThis.settings.api.callback.error.function.apply(objThis.settings.api.callback.error.this,[$.extend(!0,{},data,objThis.settings.api.callback.error.parameters)])}
                        if(objThis.settings.status.response_from_api_visible&&return_message){objThis.StatusAdd(return_message,{style:'error'})}}
                    objThis.settings.status.ajax_processing=!1},error:function(data){console.log('API status: '+data.status);console.log('API message: ');console.log(data[settings.return_param]);status={success:!1,message:'Error (API x:0)'};objThis.settings.status.ajax_processing=!1;if(settings.callback.error.function&&$.isFunction(settings.callback.error.function)){settings.callback.error.function.apply(settings.callback.error.this,settings.callback.error.parameters)}
                    if(objThis.settings.api.callback.error.function&&$.isFunction(objThis.settings.api.callback.error.function)){objThis.settings.api.callback.error.function.apply(objThis.settings.api.callback.error.this,objThis.settings.api.callback.error.parameters)}}})}
            return status},StatusAdd:function(_message,options){var defaults={fade_duration:300,style:''};var settings=$.extend({},defaults,options);var message=$('<p></p>');message.text(_message);message.appendTo(this.popup.footer);message.hide();if(settings.style==='success'){this.StatusClearStyle();this.popup.footer.addClass('success')}else if(settings.style==='error'){this.StatusClearStyle();this.popup.footer.addClass('error')}
            message.fadeIn(settings.fade_duration)},StatusClearStyle:function(){this.popup.footer.removeClass('success error')},StatusClear:function(){this.StatusClearStyle();this.popup.footer.empty()},TogglePopup:function(options){if(this.settings.status.button_disabled){return}
            if(this.settings.status.popup_hidden){this.ShowPopup(options)}else{this.ClosePopup(options)}},ShowPopup:function(options){if(this.settings.status.button_disabled){return}
            var objThis=this;var defaults={fade_duration:300,};var settings=$.extend({},defaults,options);this.popup.obj.fadeIn(settings.fade_duration);this.popup.form.find(input_all_mask).first().focus();this.button.obj.addClass('hide');this.settings.status.popup_hidden=!1},ClosePopup:function(options){if(this.settings.status.button_disabled){return}
            var objThis=this;var defaults={fade_duration:300,};var settings=$.extend({},defaults,options);this.popup.obj.fadeOut(settings.fade_duration,function(){objThis.ResetInput();objThis.StatusClear()});this.button.obj.removeClass('hide');this.settings.status.popup_hidden=!0},DisableButton:function(input){this.settings.status.button_disabled=!!input},ValidateField:function(_field,options){var defaults={};var settings=$.extend({},defaults,options);var field=_field;var $this=field.obj;var is_valid=!0;if(field.type==='checkbox'){if(field.required===!0){if(!$this.prop('checked')){is_valid=!1}}}
        else if(field.type==='select'){}
        else{if(field.required===!0||$this.val()!==''){var regex_table=this.settings.input.regex_table;if(field.data_field_type&&field.data_field_type in regex_table){var regex=regex_table[field.data_field_type];if(!regex.test($this.val())){is_valid=!1}}else{is_valid=!1}}}
            return{is_valid:is_valid,field:field}},ValidateForm:function(_fields,options){var defaults={append_status:!0,focus_first_wrong:!0,fade_duration:300,};var settings=$.extend({},defaults,options);var fields=_fields;var is_valid=!0;var wrong_inputs=[];for(var i=0;i<fields.length;i++){var field=fields[i];var field_valid=this.ValidateField(field);var $this=field.obj;var $this_container=$this.closest('.input');var old_obj=$this_container.find('.'+form_obj_prefix+'status');if(settings.append_status){old_obj.remove()}else{old_obj.fadeOut(settings.fade_duration,function(){old_obj.remove()})}
            if(field_valid.is_valid){$this.removeClass('wrong-input');$this_container.removeClass('wrong-input');$this.addClass('correct-input');$this_container.addClass('correct-input')}else{$this.removeClass('correct-input');$this_container.removeClass('correct-input');$this.addClass('wrong-input');$this_container.addClass('wrong-input');wrong_inputs.push({field:field,message:''});if(settings.append_status){var $wrong_input_obj=$('<span class="'+form_obj_prefix+'status"></span>');$wrong_input_obj.text(this.settings.text_vars.wrong_input_text);$wrong_input_obj.hide();$wrong_input_obj.appendTo($this_container);$wrong_input_obj.fadeIn(settings.fade_duration)}
                is_valid=!1}}
            if(settings.focus_first_wrong&&wrong_inputs.length>0){wrong_inputs=this.objSortByPositionInDOM(wrong_inputs,'field','obj');wrong_inputs[0].field.obj.focus()}
            return is_valid},SendDataReturn:function(_message,_style){this.ResetInput();this.StatusClear();this.StatusAdd(_message,{style:_style})},ResetInput:function(){var form=this.popup.form;form[0].reset();this.hideReadmore_all()},formatData:function(input){var _input=input;var input_length=_input.length;var output='';if(_input){output+=' ';if(input.constructor===Array){for(var i=0;i<input_length;i++){output+='data-'+_input[i][0]+'='+_input[i][1]+' '}
            if(output[output.length-1]===' '){output=output.slice(0,-1)}}else{output+='data-'+_input}}
            return output},formatDynamicAttributes:function(collection){var _collection=collection;for(var i=0;i<_collection.length;i++){var attributes=_collection[i].attributes;var formatted='';for(var x=0;x<attributes.length;x++){formatted+=attributes[x].key+'="';formatted+=attributes[x].value;formatted+='" '}
            if(formatted.length>0&&formatted[formatted.length-1]==' '){formatted=formatted.slice(0,-1)}
            _collection[i].formatted=formatted}
            return _collection},objSortByPositionInDOM:function(input,attr,attr2){var _input=input;var output;if(attr&&attr2){output=_input.sort(function(a,b){if(a[attr][attr2][0]===b[attr][attr2][0])return 0;if(!a[attr][attr2][0].compareDocumentPosition){return a[attr][attr2][0].sourceIndex-b[attr][attr2][0].sourceIndex}
            if(a[attr][attr2][0].compareDocumentPosition(b[attr][attr2][0])&2){return 1}
            return-1})}
        else if(attr){output=_input.sort(function(a,b){if(a[attr][0]===b[attr][0])return 0;if(!a[attr][0].compareDocumentPosition){return a[attr][0].sourceIndex-b[attr][0].sourceIndex}
            if(a[attr][0].compareDocumentPosition(b[attr][0])&2){return 1}
            return-1})}else{output=_input.sort(function(a,b){if(a[0]===b[0])return 0;if(!a[0].compareDocumentPosition){return a[0].sourceIndex-b[0].sourceIndex}
            if(a[0].compareDocumentPosition(b[0])&2){return 1}
            return-1})}
            return output},});$.fn[pluginName]=function(options){var instances=[];this.each(function(){if(!$.data(this,"plugin_"+pluginName)){var instance=new Plugin(this,options);$.data(this,"plugin_"+pluginName,instance);instances.push(instance)}});if(instances.length===1){return instances[0]}
        return null}})(jQuery,window,document)